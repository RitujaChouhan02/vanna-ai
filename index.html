<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ask Vanna AI</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 2rem auto; }
    input, button { padding: 0.5rem; width: 100%; margin-top: 1rem; }
    pre { background: #f4f4f4; padding: 1rem; border-radius: 5px; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
    th { background-color: #f0f0f0; }
  </style>
</head>
<body>
  <h1>Ask SQL in Natural Language</h1>
  <input type="text" id="question" placeholder="e.g. What is the total revenue this month?" />
  <button onclick="ask()">Generate SQL</button>

  <h3>Generated SQL:</h3>
  <pre id="output">Your SQL will appear here...</pre>

  <h3>Query Result:</h3>
  <div id="result"></div>

  <script>
    async function ask() {
      const question = document.getElementById('question').value;
  
      try {
        const res = await fetch('http://localhost:8000/generate-sql', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ question })
        });
  
        if (!res.ok) {
          const error = await res.json();
          throw new Error(error.error || "Something went wrong");
        }
  
        const data = await res.json();
        document.getElementById('output').innerText = data.sql || data.error;
  
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = ''; // Clear previous
  
        if (data.result && data.result.length > 0) {
          const table = document.createElement('table');
          table.border = 1;
  
          // Table Header
          const headerRow = table.insertRow();
          Object.keys(data.result[0]).forEach(key => {
            const cell = headerRow.insertCell();
            cell.outerHTML = `<th>${key}</th>`;
          });
  
          // Table Rows
          data.result.forEach(row => {
            const rowElement = table.insertRow();
            Object.values(row).forEach(value => {
              const cell = rowElement.insertCell();
              cell.textContent = value;
            });
          });
  
          resultDiv.appendChild(table);
        } else {
          resultDiv.innerHTML = 'No results found or query failed.';
        }
      } catch (error) {
        document.getElementById('output').innerText = `Error: ${error.message}`;
      }
    }
  </script>
  
</body>
</html>
